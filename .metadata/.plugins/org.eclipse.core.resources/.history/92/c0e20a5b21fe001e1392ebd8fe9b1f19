package days02;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.util.DBConn;

import domain.DeptVO;

/**
 * Servlet implementation class ScottEmp
 */
@WebServlet({ "/ScottEmp", "/scottEmp", "/scottemp" })
public class ScottEmp extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public ScottEmp() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request
			, HttpServletResponse response) throws ServletException, IOException {
		Connection econn = DBConn.getConnection();
		  PreparedStatement epstmt = null;
		  ResultSet ers = null;
		  String esql = " SELECT empno, ename, job, mgr, to_char(hiredate, 'yyyy-MM-dd') hiredate, sal, comm, deptno  "
				  	 + " FROM emp "
				  	 + " WHERE deptno = ? ";
		  int empno;
		  String ename; 
		  String job;
		  int mgr; 	
		  Date hiredate;
		  Double sal;
		  Double comm;
		  
		  //?deptno=20
		  String pdeptno = request.getParameter("deptno");
		  if( pdeptno == null || pdeptno.equals("")) pdeptno ="10";  
		  deptno = Integer.parseInt(pdeptno);
		  
		  EmpVO evo = null;
		  ArrayList<EmpVO> elist = null;
		  
		  try{
				  epstmt = econn.prepareStatement(sql);
				  epstmt.setInt(1, deptno);
				  ers = epstmt.executeQuery();
				  if( ers.next() ) {
					  list = new ArrayList<>();
					  do{
						  empno = ers.getInt("empno");
						  ename = ers.getString("ename"); 
						  job = ers.getString("job"); 
						  mgr = ers.getInt("mgr"); 	
						  hiredate = ers.getDate("hiredate");
						  sal = ers.getDouble("sal");
						  comm = ers.getDouble("comm");
						  evo = new EmpVO(empno, ename, job, mgr, hiredate
								   , sal, comm, deptno);
						   
						  elist.add(evo);
						  
					  } while( ers.next() );
				  } // if
			  } catch(Exception e){
				  e.printStackTrace();
			  } finally{
				  try{
					  pstmt.close();
					  rs.close();
					  DBConn.close();
				  }catch(SQLException e){
					  e.printStackTrace();
				  } //try	  
			  } // try 
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
