package days09;

import java.io.IOException;
import java.sql.Connection;
import java.util.ArrayList;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.util.ConnectionProvider;
import com.util.JdbcUtil;

@WebServlet("*.ss")
public class FileTestServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

    public FileTestServlet() {
        super();
    }

	protected void doGet(HttpServletRequest request
			, HttpServletResponse response) throws ServletException, IOException {
		String uri = request.getRequestURI();  // list.ss  write.ss  update.ss ...등등
		
		Connection conn = null;
		String saveDirectory = null;
		
		// MVC 패턴
		// commandHandler.properties  list.ss => ListHandler.java X
		// init()    commandHandlerMap <url, Handler>
		try {
			conn = ConnectionProvider.getConnection();
			FileTestDAO dao = FileTestDAO.getInstance();  // 싱글톤
			// ㄴ
			saveDirectory =  request.getRealPath("/days09/upload");
			System.out.println(saveDirectory);
			
			if (uri.endsWith("list.ss")) { // 자료실 목록 보기				
				ArrayList<FileTestDTO> list = dao.selectFileList(conn);
				request.setAttribute("list", list);
				
				String path = "/days09/ex04_list.jsp";
				RequestDispatcher dispatcher = request.getRequestDispatcher(path);
				dispatcher.forward(request, response);
				
			} else if (uri.endsWith("write.ss")) { // 글쓰기 + write.jsp
				String path = "/days09/ex04_write.jsp";
				RequestDispatcher dispatcher = request.getRequestDispatcher(path);
				dispatcher.forward(request, response);
				
			} else if (uri.endsWith("write_ok.ss")) { // 글쓰기 저장
				
			} else if (uri.endsWith("delete.ss")) { // 삭제
				
			} else if (uri.endsWith("update.ss")) { // 수정 + update.jsp
				
			} else if (uri.endsWith("update_ok.ss")) { // 수정 저장.
				
			}			
			
			
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			JdbcUtil.close(conn);
		}
		
	}// doGet

	protected void doPost(HttpServletRequest request
			, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}

}
