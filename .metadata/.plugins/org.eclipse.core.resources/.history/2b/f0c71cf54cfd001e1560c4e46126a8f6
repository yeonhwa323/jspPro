<%@page import="domain.EmpVO"%>
<%@page import="java.util.Date"%>
<%@page import="java.util.Iterator"%>
<%@page import="java.sql.SQLException"%>
<%@page import="java.util.ArrayList"%>
<%@page import="domain.DeptVO"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="com.util.DBConn"%>
<%@page import="java.sql.Connection"%>
<%@ page contentType="text/html; charset=EUC-KR" pageEncoding="EUC-KR"%>
<%
  
  Connection conn = DBConn.getConnection();
  PreparedStatement pstmt = null;
  ResultSet rs = null;
  String sql = " SELECT empno, ename, job, mgr, to_char(hiredate, 'yyyy-MM-dd') hiredate, sal, comm, deptno  "
		  	 + " FROM emp "
		  	 + " WHERE deptno = ? ";
  int deptno;
  String dname;
  String loc;
  
  //?deptno=20
  String pdeptno = request.getParameter("deptno");
  if( pdeptno == null || pdeptno.equals("")) pdeptno ="10";  
  deptno = Integer.parseInt(pdeptno);
  
  DeptVO vo = null;
  ArrayList<DeptVO> list = null;
  
  try{
		  pstmt = conn.prepareStatement(sql);
		  pstmt.setInt(1, deptno);
		  rs = pstmt.executeQuery();
		  if( rs.next() ) {
			  list = new ArrayList<>();
			  do{
				  deptno = rs.getInt("deptno");
				  dname = rs.getString("dname"); 
				  loc = rs.getString("loc"); 
				  
				  vo = new DeptVO( deptno, dname, loc );
				   
				  list.add(vo);
				  
			  } while( rs.next() );
		  } // if
	  } catch(Exception e){
		  e.printStackTrace();
	  } finally{
		  try{
			  pstmt.close();
			  rs.close();
			  DBConn.close();
		  }catch(SQLException e){
			  e.printStackTrace();
		  } //try	  
	  } // try 

%>
<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Insert title here</title>
<link rel="shortcut icon" href="http://localhost/jspPro/images/SiSt.ico">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="/jspPro/resources/cdn-main/example.css">
<script src="/jspPro/resources/cdn-main/example.js"></script>
<style>
span.material-symbols-outlined {
	vertical-align: text-bottom;
}
</style>
</head>
<body>
	<header>
		<h1 class="main">
			<a href="#" style="position: absolute; top: 30px;">yeon HOme</a>
		</h1>
		<ul>
			<li><a href="#">로그인</a></li>
			<li><a href="#">회원가입</a></li>
		</ul>
	</header>
	<h3>
		<span class="material-symbols-outlined">view_list</span> jsp days00
	</h3>
	<div>
		<xmp class="code"> </xmp>

		<h2>dept list</h2>
		<table>
				<thead>
					<tr>
						<td>deptno</td>
						<td>dname</td>
						<td>loc</td>
					</tr>
				</thead>
				<tbody>
		<%
		  	    if( list == null ){
		%>
						<tr>
							<td colspan="8">사원 존재 X</td>
						</tr>
		<% 	
		  	    } else {
		  	    	
		  	    	Iterator<DeptVO> ir = list.iterator();
		  	    	while( ir.hasNext()) {
		  	    		vo = ir.next();		  	    	
		 %>
						<tr>
							<td><%= vo.getDeptno() %></td> 
							<td><%= vo.getDname() %></td>
							<td><%= vo.getLoc() %></td>
						</tr>
		<%
		  	    	} // while
		  	    
		  	    } // if
	  	%>
				</tbody>
				<tfoot>
					<tr>
						<td colspan="8"><span class="badge left red"> <%= list ==null ? 0 : list.size() %>
						</span> 명. 
						<a href="javascript:history.back()">뒤로 가기</a>
						</td>
					</tr>
				</tfoot>
		</table>

	</div>

<script>
</script>
</body>
</html>